---
import { twMerge } from 'tailwind-merge';

import { ui, defaultLang } from '@i18n/ui';
import { getLangFromUrl, useTranslations } from '@i18n/utils';
import type { HTMLAttributes } from 'astro/types';

type TextTag =
  | 'h1'
  | 'h2'
  | 'h3'
  | 'h4'
  | 'h5'
  | 'h6'
  | 'p'
  | 'span'
  | 'label'
  | 'a';

type Props = HTMLAttributes<TextTag> & {
  tag: TextTag;
  textId?: keyof (typeof ui)[typeof defaultLang];
  literal?: string;
  href?: string;
  target?: string;
  rel?: string;
};

const {
  textId,
  literal,
  tag = 'span',
  class: classProp = '',
  ...props
}: Props = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const isValidTag = (tag: string): tag is TextTag => {
  return [
    'h1',
    'h2',
    'h3',
    'h4',
    'h5',
    'h6',
    'p',
    'span',
    'label',
    'a',
  ].includes(tag);
};

const proseSize = {
  h1: 'text-3xl lg:text-3xl xl:text-4xl 2xl:text-5xl',
  h2: 'text-xl lg:text-2xl xl:text-3xl 2xl:text-4xl',
  h3: 'text-lg lg:text-xl xl:text-2xl 2xl:text-3xl',
  h4: 'text-base lg:text-lg xl:text-xl 2xl:text-2xl',
  h5: 'text-base lg:text-lg xl:text-xl 2xl:text-2xl',
  h6: 'text-base',
  p: 'text-sm md:text-sm lg:text-base xl:text-base 2xl:text-xl',
  span: 'text-sm md:text-sm lg:text-base xl:text-base 2xl:text-xl',
  label: 'text-sm md:text-sm lg:text-base xl:text-base 2xl:text-xl',
  a: 'text-sm md:text-sm lg:text-base hover:text-teal-600 transition-colors duration-500 cursor-pointer',
};

const classList = proseSize[tag] || 'text-base';

const Tag = isValidTag(tag) ? tag : 'span';
const text = textId ? t(textId) : literal || '';
---

<Tag
  {...props}
  aria-label={text}
  id={textId}
  data-text-id={textId}
  class:list={twMerge(classList, classProp)}>{text}</Tag
>
